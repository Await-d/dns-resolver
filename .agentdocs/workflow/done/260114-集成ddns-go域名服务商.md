# 集成 ddns-go 域名服务商

## 任务概述

将 ddns-go 项目中支持的 23 个域名服务商集成到 dns-resolver 项目中，实现域名解析记录的管理功能（查询、新增、修改、删除）。

## 源码分析

### ddns-go 支持的域名服务商（共 23 个）

| 序号 | 服务商名称 | 文件 | API 类型 | 认证方式 |
|------|-----------|------|----------|----------|
| 1 | 阿里云 DNS (Alidns) | alidns.go | REST API | AccessKey ID/Secret |
| 2 | 阿里云 ESA | aliesa.go | REST API | AccessKey ID/Secret |
| 3 | 腾讯云 (TencentCloud) | tencent_cloud.go | REST API | SecretId/SecretKey |
| 4 | 腾讯云 TrafficRoute | traffic_route.go | REST API | SecretId/SecretKey |
| 5 | DNSPod | dnspod.go | REST API | ID/Token |
| 6 | DNS.LA | dnsla.go | REST API | API Key |
| 7 | Cloudflare | cloudflare.go | REST API | Bearer Token |
| 8 | 华为云 (Huaweicloud) | huawei.go | REST API | AK/SK |
| 9 | 百度云 (BaiduCloud) | baidu.go | REST API | AccessKey/SecretKey |
| 10 | GoDaddy | godaddy.go | REST API | API Key/Secret |
| 11 | Namecheap | namecheap.go | REST API | API Key |
| 12 | NameSilo | namesilo.go | REST API | API Key |
| 13 | Porkbun | porkbun.go | REST API | API Key/Secret |
| 14 | Vercel | vercel.go | REST API | Bearer Token |
| 15 | Dynadot | dynadot.go | REST API | API Key |
| 16 | Dynv6 | dynv6.go | REST API | Token |
| 17 | Spaceship | spaceship.go | REST API | API Key/Secret |
| 18 | Now.cn (时代互联) | nowcn.go | REST API | Username/Password |
| 19 | Eranet (时代互联国际) | eranet.go | REST API | Username/Password |
| 20 | Gcore | gcore.go | REST API | API Key |
| 21 | EdgeOne (腾讯边缘安全) | edgeone.go | REST API | SecretId/SecretKey |
| 22 | NS1 | nsone.go | REST API | API Key |
| 23 | Callback (自定义回调) | callback.go | HTTP Callback | 自定义 |

### 服务商分类

#### 国内服务商（8 个）
- 阿里云 DNS、阿里云 ESA
- 腾讯云、腾讯云 TrafficRoute、DNSPod、EdgeOne
- 华为云
- 百度云

#### 国际服务商（14 个）
- Cloudflare、Vercel、Gcore
- GoDaddy、Namecheap、NameSilo、Porkbun、Dynadot、Spaceship
- Dynv6、NS1
- Now.cn、Eranet

#### 特殊类型（1 个）
- Callback（自定义回调）

## 解决方案设计

### 架构设计

```
DnsResolver.Core/
├── Interfaces/
│   ├── IDnsResolver.cs          # 现有：DNS 查询接口
│   └── IDnsProvider.cs          # 新增：DNS 服务商接口
├── Models/
│   ├── DnsRecord.cs             # 现有
│   ├── Provider/                # 新增：服务商相关模型
│   │   ├── DnsProviderConfig.cs
│   │   ├── DnsRecordInfo.cs
│   │   └── ProviderResult.cs
│   └── ...
├── Services/
│   ├── DnsResolverService.cs    # 现有
│   └── Providers/               # 新增：服务商实现
│       ├── BaseDnsProvider.cs   # 基类
│       ├── AlidnsProvider.cs
│       ├── CloudflareProvider.cs
│       ├── DnspodProvider.cs
│       └── ...
└── Factories/
    └── DnsProviderFactory.cs    # 新增：服务商工厂
```

### 核心接口设计

```csharp
// IDnsProvider.cs
public interface IDnsProvider
{
    string Name { get; }
    string DisplayName { get; }

    // 初始化配置
    void Configure(DnsProviderConfig config);

    // 获取域名列表
    Task<ProviderResult<IReadOnlyList<string>>> GetDomainsAsync(CancellationToken ct = default);

    // 获取记录列表
    Task<ProviderResult<IReadOnlyList<DnsRecordInfo>>> GetRecordsAsync(
        string domain, string? recordType = null, CancellationToken ct = default);

    // 添加记录
    Task<ProviderResult<DnsRecordInfo>> AddRecordAsync(
        string domain, string subDomain, string recordType, string value, int ttl = 600, CancellationToken ct = default);

    // 更新记录
    Task<ProviderResult<DnsRecordInfo>> UpdateRecordAsync(
        string domain, string recordId, string value, int? ttl = null, CancellationToken ct = default);

    // 删除记录
    Task<ProviderResult> DeleteRecordAsync(
        string domain, string recordId, CancellationToken ct = default);
}
```

## 实现计划

### 阶段 1：基础架构搭建 ✅
- [x] T-01: 创建 `IDnsProvider` 接口
- [x] T-02: 创建 `DnsProviderConfig` 配置模型
- [x] T-03: 创建 `DnsRecordInfo` 记录模型
- [x] T-04: 创建 `ProviderResult<T>` 结果模型
- [x] T-05: 创建 `BaseDnsProvider` 抽象基类
- [x] T-06: 创建 `DnsProviderFactory` 工厂类

### 阶段 2：国内主流服务商实现（优先级高） ✅
- [x] T-07: 实现 `AlidnsProvider` (阿里云 DNS)
- [x] T-08: 实现 `TencentCloudProvider` (腾讯云)
- [x] T-09: 实现 `DnspodProvider` (DNSPod)
- [x] T-10: 实现 `HuaweicloudProvider` (华为云)
- [x] T-11: 实现 `BaiduCloudProvider` (百度云)
- [x] T-12: 实现 `CloudflareProvider` (Cloudflare)

### 阶段 3：国际主流服务商实现 ✅
- [x] T-13: 实现 `GoDaddyProvider`
- [x] T-14: 实现 `NamecheapProvider`
- [x] T-15: 实现 `NameSiloProvider`
- [x] T-16: 实现 `PorkbunProvider`
- [x] T-17: 实现 `VercelProvider`

### 阶段 4：其他服务商实现 ✅
- [x] T-18: 实现 `AliesaProvider` (阿里云 ESA)
- [x] T-19: 实现 `TrafficRouteProvider` (腾讯云 TrafficRoute)
- [x] T-20: 实现 `DnslaProvider` (DNS.LA)
- [x] T-21: 实现 `DynadotProvider`
- [x] T-22: 实现 `Dynv6Provider`
- [x] T-23: 实现 `SpaceshipProvider`
- [x] T-24: 实现 `NowcnProvider` (时代互联)
- [x] T-25: 实现 `EranetProvider` (时代互联国际)
- [x] T-26: 实现 `GcoreProvider`
- [x] T-27: 实现 `EdgeOneProvider` (腾讯边缘安全)
- [x] T-28: 实现 `NSOneProvider`
- [x] T-29: 实现 `CallbackProvider` (自定义回调)

### 阶段 5：API 层集成 ✅
- [x] T-30: 创建 `DnsProviderController` API 控制器
- [x] T-31: 添加服务商配置管理 API
- [x] T-32: 添加域名记录管理 API

### 阶段 6：前端集成 ✅
- [x] T-33: 创建服务商配置页面
- [x] T-34: 创建域名记录管理页面
- [x] T-35: 集成到现有 UI

## 技术要点

### 1. 认证方式处理

| 认证类型 | 服务商 | 实现方式 |
|---------|--------|---------|
| AccessKey/Secret | 阿里云、华为云、百度云 | 签名算法 |
| SecretId/SecretKey | 腾讯云系列 | 签名算法 |
| Bearer Token | Cloudflare、Vercel | HTTP Header |
| API Key/Secret | GoDaddy、Porkbun 等 | HTTP Header |
| ID/Token | DNSPod | Form 参数 |

### 2. 签名算法

- **阿里云**: 需要实现阿里云 V3 签名算法
- **腾讯云**: 需要实现腾讯云 TC3-HMAC-SHA256 签名
- **华为云**: 需要实现华为云 AK/SK 签名

### 3. 错误处理

统一错误码设计：
- `Success`: 操作成功
- `AuthenticationFailed`: 认证失败
- `DomainNotFound`: 域名不存在
- `RecordNotFound`: 记录不存在
- `RecordExists`: 记录已存在
- `RateLimited`: 请求频率限制
- `NetworkError`: 网络错误
- `UnknownError`: 未知错误

## 依赖项

需要添加的 NuGet 包：
- `System.Text.Json` (已有)
- 无需额外依赖，使用 `HttpClient` 实现 API 调用

## 备注

- 参考 ddns-go 的实现逻辑，但需要适配 C# 的编程风格
- 所有 API 调用使用 `HttpClient` + `IHttpClientFactory`
- 支持依赖注入，便于测试和扩展
- 考虑添加请求重试和超时机制
